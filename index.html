<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CDR Analyzer</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>
</head>
<body class="bg-light"><div class="container py-5">
  <h2 class="mb-4 text-center">ðŸ“ž CDR Analyzer</h2>  <div class="mb-3">
    <label for="csvFile" class="form-label">Upload CDR CSV File</label>
    <input class="form-control" type="file" id="csvFile" accept=".csv">
  </div>  <div class="row mb-4">
    <div class="col-md-4">
      <label for="minDuration" class="form-label">Min Duration (sec)</label>
      <input type="number" class="form-control" id="minDuration" value="0">
    </div>
    <div class="col-md-4">
      <label for="callType" class="form-label">Call Type</label>
      <select class="form-select" id="callType">
        <option value="">All</option>
        <option value="Incoming">Incoming</option>
        <option value="Outgoing">Outgoing</option>
        <option value="Missed">Missed</option>
      </select>
    </div>
    <div class="col-md-4 d-flex align-items-end">
      <button class="btn btn-primary w-100" onclick="applyFilters()">Apply Filters</button>
    </div>
  </div>  <div class="mb-3 text-end">
    <button class="btn btn-success" onclick="downloadExcel()">Download as Excel</button>
  </div>  <div class="table-responsive">
    <table id="cdrTable" class="table table-striped table-bordered d-none">
      <thead id="cdrHead"></thead>
      <tbody id="cdrBody"></tbody>
    </table>
  </div>  <div class="mt-3">
    <h5>ðŸ“Š Summary:</h5>
    <p id="summary"></p>
  </div>
</div><script>
  let cdrData = [];
  let filteredData = [];

  document.getElementById('csvFile').addEventListener('change', function (e) {
    const file = e.target.files[0];
    if (!file) return;

    Papa.parse(file, {
      header: true,
      skipEmptyLines: true,
      complete: function (results) {
        cdrData = results.data;
        filteredData = cdrData;
        renderTable(filteredData);
      }
    });
  });

  function applyFilters() {
    const minDuration = parseInt(document.getElementById('minDuration').value) || 0;
    const type = document.getElementById('callType').value;

    filteredData = cdrData.filter(row => {
      const dur = parseInt(row['Duration'] || 0);
      const callType = (row['Type'] || '').trim();
      return dur >= minDuration && (!type || callType === type);
    });

    renderTable(filteredData);
  }

  function renderTable(data) {
    const table = document.getElementById('cdrTable');
    const head = document.getElementById('cdrHead');
    const body = document.getElementById('cdrBody');

    head.innerHTML = '';
    body.innerHTML = '';

    if (!data.length) {
      table.classList.add('d-none');
      document.getElementById('summary').textContent = 'No data to display.';
      return;
    }

    const headers = Object.keys(data[0]);
    const headerRow = document.createElement('tr');
    headers.forEach(h => {
      const th = document.createElement('th');
      th.textContent = h;
      headerRow.appendChild(th);
    });
    head.appendChild(headerRow);

    data.forEach(row => {
      const tr = document.createElement('tr');
      headers.forEach(h => {
        const td = document.createElement('td');
        td.textContent = row[h];
        tr.appendChild(td);
      });
      body.appendChild(tr);
    });

    table.classList.remove('d-none');

    const total = data.length;
    const totalDuration = data.reduce((sum, row) => sum + (parseInt(row['Duration']) || 0), 0);
    document.getElementById('summary').textContent = `${total} calls, Total duration: ${totalDuration} seconds`;
  }

  function downloadExcel() {
    const ws = XLSX.utils.json_to_sheet(filteredData);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "CDR Data");
    XLSX.writeFile(wb, "CDR_Analyzed.xlsx");
  }
</script></body>
</html>
